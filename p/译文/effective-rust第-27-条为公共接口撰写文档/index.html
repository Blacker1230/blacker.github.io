<!doctype html><html lang=zh-Hans dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="本文为 effective-rust 第 27 条的译文。"><title>【译文/effective-rust】第 27 条：为公共接口撰写文档</title>
<link rel=canonical href=https://liyan-ah.github.io/p/%E8%AF%91%E6%96%87/effective-rust%E7%AC%AC-27-%E6%9D%A1%E4%B8%BA%E5%85%AC%E5%85%B1%E6%8E%A5%E5%8F%A3%E6%92%B0%E5%86%99%E6%96%87%E6%A1%A3/><link rel=stylesheet href=/scss/style.min.8e60baf4cd3fc55968717a6e39762f4d28ed7ef6007566b6c7970ad0fe907198.css><meta property='og:title' content="【译文/effective-rust】第 27 条：为公共接口撰写文档"><meta property='og:description' content="本文为 effective-rust 第 27 条的译文。"><meta property='og:url' content='https://liyan-ah.github.io/p/%E8%AF%91%E6%96%87/effective-rust%E7%AC%AC-27-%E6%9D%A1%E4%B8%BA%E5%85%AC%E5%85%B1%E6%8E%A5%E5%8F%A3%E6%92%B0%E5%86%99%E6%96%87%E6%A1%A3/'><meta property='og:site_name' content='李岩'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='译文'><meta property='article:tag' content='effective-rust'><meta property='article:published_time' content='2024-06-17T15:08:08+08:00'><meta property='article:modified_time' content='2024-06-17T15:08:08+08:00'><meta name=twitter:title content="【译文/effective-rust】第 27 条：为公共接口撰写文档"><meta name=twitter:description content="本文为 effective-rust 第 27 条的译文。"><link rel="shortcut icon" href=/icon.jpg></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切换菜单>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu16177073813840188542.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>李岩</a></h1><h2 class=site-description>努力做个工程师。</h2></div></header><ol class=menu-social><li><a href=https://github.com/liyan-ah/liyan-ah.github.io/issues/new target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>暗色模式</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目录</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#工具>工具</a></li><li><a href=#其他的文档位置>其他的文档位置</a></li><li><a href=#发布包的文档>发布包的文档</a></li><li><a href=#不文档化的内容>不文档化的内容</a></li><li><a href=#总结>总结</a><ol><li><a href=#注释>注释</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/%E7%A8%8B%E5%BA%8F%E4%BA%BA%E7%94%9F/ style=background-color:#2a9d8f;color:#fff>程序人生</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/%E8%AF%91%E6%96%87/effective-rust%E7%AC%AC-27-%E6%9D%A1%E4%B8%BA%E5%85%AC%E5%85%B1%E6%8E%A5%E5%8F%A3%E6%92%B0%E5%86%99%E6%96%87%E6%A1%A3/>【译文/effective-rust】第 27 条：为公共接口撰写文档</a></h2><h3 class=article-subtitle>本文为 effective-rust 第 27 条的译文。</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jun 17, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>阅读时长: 7 分钟</time></div></footer></div></header><section class=article-content><blockquote><p>原文由笔者翻译并提交至 <a class=link href=https://rustx-labs.github.io/effective-rust-cn/chapter_5/item27-document-public-interfaces.html target=_blank rel=noopener>rustx-labs/effective-rust-cn/item27</a>，同步转载到此处。</p></blockquote><p>如果你的包（crate）会被其他程序员所使用，那么为包中的内容添加文档就是很好的实践，尤其是包中的公共接口。如果你的包不仅仅是随用随丢的代码，那么这个“其他程序员”就包括未来的你，那个已经忘掉了自己代码细节的你。</p><p>这个建议并不是 Rust 所独有的，它也并不是一个新的建议 —— 比如，<a class=link href=https://www.oreilly.com/library/view/effective-java-2nd/9780137150021/ target=_blank rel=noopener>Effective Java</a> 第二版（2008年出版）在第 44 条中建议：“为所有导出的 API 元素编写文档注释”。</p><p>Rust 文档类型注释的细节 —— 基于 Markdown 格式，以 /// 或者 //! 分割 —— 已经在<a class=link href=https://doc.rust-lang.org/book/ch14-02-publishing-to-crates-io.html#making-useful-documentation-comments target=_blank rel=noopener>Rust book</a>中介绍了，如下为示例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Rust data-lang=Rust><span class=line><span class=cl><span class=sd>/// Calculate the [`BoundingBox`] that exactly encompasses a pair
</span></span></span><span class=line><span class=cl><span class=sd>/// of [`BoundingBox`] objects.
</span></span></span><span class=line><span class=cl><span class=sd></span><span class=k>pub</span><span class=w> </span><span class=k>fn</span> <span class=nf>union</span><span class=p>(</span><span class=n>a</span>: <span class=kp>&amp;</span><span class=nc>BoundingBox</span><span class=p>,</span><span class=w> </span><span class=n>b</span>: <span class=kp>&amp;</span><span class=nc>BoundingBox</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nc>BoundingBox</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>然而，关于文档型注释的格式仍有一些值得关注的细节：</p><ul><li>使用代码格式：对于任何作为源代码的注释，使用反引号来确保在最终的文档中代码会以一种等宽字体来展示，并以此来明确的区分<code>code</code>以及一般的文本。</li><li>添加丰富的引用内容：为任何能够给读者提供上下文信息的内容添加 Markdown 链接。特别地，可以使用比较方便的 [<code>SomeThing</code>] 格式的交叉引用标注符语法 —— 括号内的<code>Something</code>将会在最终文档中被添加正确的超链接。</li><li>多添加示例代码：如果接口应该如何使用并非一目了然的，那么添加一个使用该接口的<code># Example</code>段落将会很有用。如在<a class=link href=https://doc.rust-lang.org/rustdoc/write-documentation/documentation-tests.html target=_blank rel=noopener>文档注释</a>里的示例代码会在你执行<code>cargo test</code>（详情查看<a class=link href=https://www.lurklurk.org/effective-rust/testing.html target=_blank rel=noopener>第 13 条</a>）时编译并且运行，这一特性将有助于示例代码和它希望表述的代码保持一致。</li><li>为<code>panic</code>和<code>unsafe</code>的代码添加说明文档：如果存在会导致函数<code>panic</code>的输入，在文档（<code># Panics</code>段落）里说明规避<code>panic!</code>的前置条件。同样地，在文档（<code># Safety</code>段落）里说明<code>unsafe</code>代码的使用要求。</li></ul><p>Rust 的<a class=link href=https://doc.rust-lang.org/std/index.html target=_blank rel=noopener>标准库</a>是一个能够实践了上述所有细节的优秀示例。</p><h2 id=工具><a href=#%e5%b7%a5%e5%85%b7>#</a>
工具</h2><p>在注释文档中使用 Markdown 格式不仅意味着优美的输出，还意味着需要有一个明确的转换步骤（<code>cargo doc</code>）。而转换也就会增加出现问题的可能性。</p><p>对于这个问题，最简单的建议是在写完文档后，运行<code>cargo doc --open</code>（或者<code>cargo doc --no-deps --open</code>，这个指令能够严格约束仅产生当前包中的文档）并来<em>仔细阅读生成的结果</em>。</p><p>对于所有生成超链接的有效性，你当然可以人工地去校验它们，或者让机器来完成这项工作 —— 通过<code>broken_intra_dock_links</code>的包特性<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=cp>#![deny(broken_intra_doc_links)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=sd>/// The bounding box for a [`Polygone`].
</span></span></span><span class=line><span class=cl><span class=sd></span><span class=cp>#[derive(Clone, Debug)]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>pub</span><span class=w> </span><span class=k>struct</span> <span class=nc>BoundingBox</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>当特性生效的时候，<code>cargo doc</code>将会找出无效的链接：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=n>error</span>: <span class=nc>unresolved</span><span class=w> </span><span class=n>link</span><span class=w> </span><span class=n>to</span><span class=w> </span><span class=err>`</span><span class=n>Polygone</span><span class=err>`</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> </span><span class=o>-</span>-&gt; <span class=nc>docs</span><span class=o>/</span><span class=n>src</span><span class=o>/</span><span class=n>main</span><span class=p>.</span><span class=n>rs</span>:<span class=mi>4</span>:<span class=mi>30</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>4</span><span class=w> </span><span class=o>|</span><span class=w> </span><span class=sd>/// The bounding box for a [`Polygone`].
</span></span></span><span class=line><span class=cl><span class=sd></span><span class=w>  </span><span class=o>|</span><span class=w>                              </span><span class=o>^^^^^^^^</span><span class=w> </span><span class=n>no</span><span class=w> </span><span class=n>item</span><span class=w> </span><span class=n>named</span><span class=w> </span><span class=err>`</span><span class=n>Polygone</span><span class=err>`</span><span class=w> </span><span class=k>in</span><span class=w> </span><span class=n>scope</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=o>|</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>你也可以设置要求文档化，通过在包里设置<code>![warn(missing_docs)]</code>属性。当设置生效的时候，编译器将会给每个未配置文档的公开条目生成警告信息。然而，这样设置也存在着为了解决编译器报错而提供低质量注释文档的风险 —— 当然设置引入的问题不仅如此。</p><p>同样地，为了能够及时发现潜在风险，这些工具应该被纳入到你的持续集成系统（<a class=link href=https://www.lurklurk.org/effective-rust/ci.html target=_blank rel=noopener>第 32 条</a>）。</p><h2 id=其他的文档位置><a href=#%e5%85%b6%e4%bb%96%e7%9a%84%e6%96%87%e6%a1%a3%e4%bd%8d%e7%bd%ae>#</a>
其他的文档位置</h2><p><code>cargo doc</code>的输出是包中文档所在的主要位置，但并不是唯一的地方 —— 在项目中的其他地方添加注释也可以帮助用户理解如何使用你的代码。</p><p>在 Cargo 项目的<code>examples/</code>子目录下可以添加一些方便使用包的示例代码。这些代码可以构建并运行，和集成测试（<a class=link href=https://www.lurklurk.org/effective-rust/testing.html target=_blank rel=noopener>第 30 条</a>）的运行方式非常类似，不同的是这些代码提供的是便于理解包中接口使用的代码。</p><p>需要说明的是，<code>tests/</code>子目录下的集成测试代码也可以给用户提供帮助，虽然它们的主要作用是测试包的对外接口。</p><h2 id=发布包的文档><a href=#%e5%8f%91%e5%b8%83%e5%8c%85%e7%9a%84%e6%96%87%e6%a1%a3>#</a>
发布包的文档</h2><p>如果你的包会发布到<code>crates.io</code>，项目的文档就可以在<a class=link href=https://docs.rs/ target=_blank rel=noopener>docs.rs</a>中查看到。docs.rs 是为发布的包构建并提供文档的官方 Rust 网站。</p><p>注意，<code>crates.io</code>和<code>docs.rs</code>的受众是不同的：<code>crates.io</code>旨在为选择包的用户提供服务，而<code>docs.rs</code>的受众是那些需要弄明白他们已经引用的包该如何使用的人（很明显的，这两种场景有很大的重叠）。</p><p>综上，一个包的主页在不同的地方会展示不同的内容：</p><ul><li><code>docs.rs</code>：展示<code>cargo doc</code>产出结果的顶层页面，比如从顶层<code>src/lib.rs</code>文件的<code>//!</code>生成的文档。</li><li><code>crates.io</code>：展示包含在项目仓库中的任何顶层<em>README.md</em> <sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>文件内容。</li></ul><h2 id=不文档化的内容><a href=#%e4%b8%8d%e6%96%87%e6%a1%a3%e5%8c%96%e7%9a%84%e5%86%85%e5%ae%b9>#</a>
不文档化的内容</h2><p>当一个项目<em>要求</em>公共条目都需要添加注释的时候，很容易就陷入到给无价值的内容也文档化的陷阱中。编译器的缺少注释文档的警告只是提醒你添加真正需要内容 —— 有用的文档 —— 的一种表现，并且仅仅期望程序员添加必要的内容来消除警告。</p><p>好的注释文档是一种能够帮助用户了解他们所使用代码的福利；糟糕的注释文档则增加了代码的维护成本并且让用户在它们不再和代码保持一致的时候变得更加困惑。那么好与不好的区别是什么呢？</p><p>最重要的建议是<em>避免重复可以从代码中看出的信息</em>。<a class=link href=https://rustx-labs.github.io/effective-rust-cn/chapter_1/item1-use-types.html target=_blank rel=noopener>第 1 条</a>建议你的代码尽量的和 Rust 的类型系统保持一致；一旦你做到了这一点，就通过类型系统来说明这些语意。可以假定使用代码的用户对 Rust 已经熟悉了 —— 可能他们已经读了一些描述了如何高效使用语言的建议 —— 并且不需要重复从代码中的参数类型和函数签名中就能读出来的东西。</p><p>回到之前的例子，一个冗余的注释文档可能如下面描述的这样：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=sd>/// Return a new [`BoundingBox`] object that exactly encompasses a pair
</span></span></span><span class=line><span class=cl><span class=sd>/// of [`BoundingBox`] objects.
</span></span></span><span class=line><span class=cl><span class=sd>///
</span></span></span><span class=line><span class=cl><span class=sd>/// Parameters:
</span></span></span><span class=line><span class=cl><span class=sd>///  - `a`: an immutable reference to a `BoundingBox`
</span></span></span><span class=line><span class=cl><span class=sd>///  - `b`: an immutable reference to a `BoundingBox`
</span></span></span><span class=line><span class=cl><span class=sd>/// Returns: new `BoundingBox` object.
</span></span></span><span class=line><span class=cl><span class=sd></span><span class=k>pub</span><span class=w> </span><span class=k>fn</span> <span class=nf>union</span><span class=p>(</span><span class=n>a</span>: <span class=kp>&amp;</span><span class=nc>BoundingBox</span><span class=p>,</span><span class=w> </span><span class=n>b</span>: <span class=kp>&amp;</span><span class=nc>BoundingBox</span><span class=p>)</span><span class=w> </span>-&gt; <span class=nc>BoundingBox</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>这个注释重复了很多从函数签名中就能读到的信息，注释信息毫无益处。</p><p>更糟的是，考虑一种代码重构后，将结果存储到其中一个参数（这是一种不兼容的变更；参照<a class=link href=https://www.lurklurk.org/effective-rust/semver.html target=_blank rel=noopener>第 21 条</a>）。没有编译器或者工具能够发现注释没有随之更新，结果就产生了一个未能和代码逻辑保持一致的注释：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=sd>/// Return a new [`BoundingBox`] object that exactly encompasses a pair
</span></span></span><span class=line><span class=cl><span class=sd>/// of [`BoundingBox`] objects.
</span></span></span><span class=line><span class=cl><span class=sd>///
</span></span></span><span class=line><span class=cl><span class=sd>/// Parameters:
</span></span></span><span class=line><span class=cl><span class=sd>///  - `a`: an immutable reference to a `BoundingBox`
</span></span></span><span class=line><span class=cl><span class=sd>///  - `b`: an immutable reference to a `BoundingBox`
</span></span></span><span class=line><span class=cl><span class=sd>/// Returns: new `BoundingBox` object.
</span></span></span><span class=line><span class=cl><span class=sd></span><span class=k>pub</span><span class=w> </span><span class=k>fn</span> <span class=nf>union</span><span class=p>(</span><span class=n>a</span>: <span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=n>BoundingBox</span><span class=p>,</span><span class=w> </span><span class=n>b</span>: <span class=kp>&amp;</span><span class=nc>BoundingBox</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>相反地，原本恰当的注释在重构中则可以毫发无损地保留下来，因为它的文本描述的是行为，而非语意本身：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=sd>/// Calculate the [`BoundingBox`] that exactly encompasses a pair
</span></span></span><span class=line><span class=cl><span class=sd>/// of [`BoundingBox`] objects.
</span></span></span><span class=line><span class=cl><span class=sd></span><span class=k>pub</span><span class=w> </span><span class=k>fn</span> <span class=nf>union</span><span class=p>(</span><span class=n>a</span>: <span class=kp>&amp;</span><span class=nc>mut</span><span class=w> </span><span class=n>BoundingBox</span><span class=p>,</span><span class=w> </span><span class=n>b</span>: <span class=kp>&amp;</span><span class=nc>BoundingBox</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>先前的建议也可以帮助提升文档质量：<em>在文档中包含任何从代码中无法了解的内容</em>。这包含前置条件、可变性、异常、报错条件以及任何可能会让用户感到意外的事情；如果你的代码不能遵守<a class=link href=https://en.wikipedia.org/wiki/Principle_of_least_astonishment target=_blank rel=noopener>最小惊讶原则</a>，确保这些意外都被记录在文档里，至少你可以说“我已经告诉过你了”。</p><p>另一个常见的失败情形是，注释里描述了其他使用这个方法的代码，而非这个方法做了什么：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=sd>/// Return the intersection of two [`BoundingBox`] objects, returning `None`
</span></span></span><span class=line><span class=cl><span class=sd>/// if there is no intersection. The collision detection code in `hits.rs`
</span></span></span><span class=line><span class=cl><span class=sd>/// uses this to do an initial check to see whether two objects might overlap,
</span></span></span><span class=line><span class=cl><span class=sd>/// before performing the more expensive pixel-by-pixel check in
</span></span></span><span class=line><span class=cl><span class=sd>/// `objects_overlap`.
</span></span></span><span class=line><span class=cl><span class=sd></span><span class=k>pub</span><span class=w> </span><span class=k>fn</span> <span class=nf>intersection</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>a</span>: <span class=kp>&amp;</span><span class=nc>BoundingBox</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>b</span>: <span class=kp>&amp;</span><span class=nc>BoundingBox</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span>-&gt; <span class=nb>Option</span><span class=o>&lt;</span><span class=n>BoundingBox</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>像这样的注释几乎不可能和代码保持一致：当使用了这个方法的代码（比如，<code>hits.rs</code>）变更的时候，这段描述了调用行为的注释相隔甚远而无法保持一致。</p><p>应当将注释重新组织以聚焦在<em>为什么</em>这样使用，可以让这段注释更好的适应未来的变更。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=sd>/// Return the intersection of two [`BoundingBox`] objects, returning `None`
</span></span></span><span class=line><span class=cl><span class=sd>/// if there is no intersection.  Note that intersection of bounding boxes
</span></span></span><span class=line><span class=cl><span class=sd>/// is necessary but not sufficient for object collision -- pixel-by-pixel
</span></span></span><span class=line><span class=cl><span class=sd>/// checks are still required on overlap.
</span></span></span><span class=line><span class=cl><span class=sd></span><span class=k>pub</span><span class=w> </span><span class=k>fn</span> <span class=nf>intersection</span><span class=p>(</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>a</span>: <span class=kp>&amp;</span><span class=nc>BoundingBox</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=n>b</span>: <span class=kp>&amp;</span><span class=nc>BoundingBox</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>)</span><span class=w> </span>-&gt; <span class=nb>Option</span><span class=o>&lt;</span><span class=n>BoundingBox</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>当编写软件时，“面向未来的编程”<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>是一种很好的实践：调整代码结构以适应未来的变更。同样的原则也适用于文档：聚焦在语意，为什么这样做以及为什么不这样做，会让文本在未来的运行中始终是有意义的。</p><h2 id=总结><a href=#%e6%80%bb%e7%bb%93>#</a>
总结</h2><ul><li>给公共的 API 内容添加注释文档。</li><li>为那些从代码中无法明确看出的内容添加描述 —— 比如<code>panics</code>以及<code>unsafe</code>的条件。</li><li>不要给可以从代码中明确看出的内容重复描述。</li><li>通过交叉引用及添加标志符来让导航变得明确。</li></ul><hr><h3 id=注释><a href=#%e6%b3%a8%e9%87%8a>#</a>
注释</h3><p>原文<a class=link href=https://www.lurklurk.org/effective-rust/documentation.html target=_blank rel=noopener>点这里</a>查看。</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>这个配置也曾称成为<code>intra_doc_link_resolution_failure</code>。&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p>包含 <em>README.md</em> 的引用动作可以被<a class=link href=https://doc.rust-lang.org/cargo/reference/manifest.html#the-readme-field target=_blank rel=noopener>Cargo.toml 中的 readme 字段</a>覆盖。&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p>Scott Meyers，More Effective C++ (Addison-Wesley)，第 32 条。&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></section><footer class=article-footer><section class=article-tags><a href=/tags/%E8%AF%91%E6%96%87/>译文</a>
<a href=/tags/effective-rust/>Effective-Rust</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相关文章</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/%E8%AF%91%E6%96%87/effective-rust%E7%AC%AC-30-%E6%9D%A1%E4%B8%8D%E4%BB%85%E4%BB%85%E6%98%AF%E5%8D%95%E6%B5%8B/><div class=article-details><h2 class=article-title>【译文/effective-rust】第 30 条：不仅仅是单测</h2></div></a></article><article><a href=/p/%E8%AF%91%E6%96%87/effective-rust%E7%AC%AC-29-%E6%9D%A1%E9%81%B5%E5%BE%AA-clippy-%E7%9A%84%E5%BB%BA%E8%AE%AE/><div class=article-details><h2 class=article-title>【译文/effective-rust】第 29 条：遵循 Clippy 的建议</h2></div></a></article><article><a href=/p/%E8%AF%91%E6%96%87/effective-rust%E7%AC%AC-28-%E6%9D%A1%E5%9C%A8%E5%90%88%E9%80%82%E7%9A%84%E6%97%B6%E5%80%99%E4%BD%BF%E7%94%A8%E5%AE%8F/><div class=article-details><h2 class=article-title>【译文/effective-rust】第 28 条：在合适的时候使用宏</h2></div></a></article><article><a href=/p/emacs-%E5%AD%97%E7%AC%A6%E6%93%8D%E4%BD%9C%E5%BF%AB%E6%8D%B7%E9%94%AE/><div class=article-details><h2 class=article-title>Emacs 字符操作快捷键</h2></div></a></article><article><a href=/p/bpftrace-%E9%81%8D%E5%8E%86-golang-%E9%93%BE%E8%A1%A8go17-/><div class=article-details><h2 class=article-title>bpftrace 遍历 golang 链表（go17+）</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2019 -
2024 李岩</section><section class=powerby>Hello, World!<br>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 构建<br>主题 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.25.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 设计</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>